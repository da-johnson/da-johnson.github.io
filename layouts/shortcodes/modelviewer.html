<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

<div id="viewer-wrapper" style="position: relative; width: 100%; height: 50vh;">
  <model-viewer id="animation-demo"
                src="/uploads/20250317.glb"
                alt="3D model"
                autoplay
                ar
                ar-modes="webxr"
                shadow-intensity="1"
                camera-controls
                touch-action="pan-y"
                scale="0.1 0.1 0.1"
                camera-orbit="0deg auto auto">
    <div slot="hotspot-nose" class="anchor" data-surface="..."></div>
    <div slot="hotspot-hoof" class="anchor" data-surface="..."></div>
    ...
  </model-viewer>

  <svg id="lines" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; pointer-events: none;">
    <line class="line"></line>
    <line class="line"></line>
    <line class="line"></line>
    <line class="line"></line>
    <line class="line"></line>
  </svg>

  <div id="container" style="position: absolute; top: 0; left: 0; width: 100%; z-index: 3; display: flex; justify-content: space-evenly; padding-top: 10px;">
    <button id="nose" class="label">Label A</button>
    ...
  </div>
</div>

<style>
  model-viewer { width: 100%; height: 100%; display: block; }
  .line { stroke: #16a5e6; stroke-width: 2; stroke-dasharray: 2; }
  .label { pointer-events: none; padding: 0.5em; font-size: 12px; background: white; }
</style>

<script type="module">
  const model = document.querySelector('#animation-demo');
  const lines = document.querySelectorAll('line');
  let baseRect, noseRect, hoofRect, tailRect, lipidRect, outerRect;

  function onResize() {
    baseRect = document.querySelector('#viewer-wrapper').getBoundingClientRect();
    noseRect = document.querySelector('#nose').getBoundingClientRect();
    hoofRect = document.querySelector('#hoof').getBoundingClientRect();
    tailRect = document.querySelector('#tail').getBoundingClientRect();
    lipidRect = document.querySelector('#lipid').getBoundingClientRect();
    outerRect = document.querySelector('#outer').getBoundingClientRect();
  }

  function drawLine(svgLine, name, rect) {
    const hotspot = model.queryHotspot('hotspot-' + name);
    if (!hotspot?.canvasPosition) return;
    svgLine.setAttribute('x1', hotspot.canvasPosition.x);
    svgLine.setAttribute('y1', hotspot.canvasPosition.y);
    svgLine.setAttribute('x2', (rect.left + rect.right) / 2 - baseRect.left);
    svgLine.setAttribute('y2', (rect.top + rect.bottom) / 2 - baseRect.top);
  }

  window.addEventListener('resize', onResize);
  model.addEventListener('load', () => {
    onResize();
    const loop = () => {
      drawLine(lines[0], 'nose', noseRect);
      drawLine(lines[1], 'hoof', hoofRect);
      drawLine(lines[2], 'tail', tailRect);
      drawLine(lines[3], 'lipid', lipidRect);
      drawLine(lines[4], 'outer', outerRect);
      requestAnimationFrame(loop);
    };
    loop();
  });
</script>
